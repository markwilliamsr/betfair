package com.betfair.aping.events.betting.overunder;

import com.betfair.aping.com.betfair.aping.events.betting.Exposure;
import com.betfair.aping.com.betfair.aping.events.betting.MatchOddsMarket;
import com.betfair.aping.com.betfair.aping.events.betting.OverUnderMarket;
import com.betfair.aping.entities.*;
import com.betfair.aping.enums.Side;
import com.google.gson.Gson;
import org.junit.Test;
import org.slf4j.Logger;
import org.slf4j.LoggerFactory;

import static org.junit.Assert.assertEquals;

/**
 * Created by markwilliams on 25/08/2014.
 */
public class ExposureTest {
    private Logger logger = LoggerFactory.getLogger(ExposureTest.class);
    final String jsonEvent = "{\"id\":\"27249641\",\"name\":\"Man City v Liverpool\",\"countryCode\":\"GB\",\"timezone\":\"Europe/London\",\"openDate\":\"Aug 25, 2014 8:00:00 PM\",\"market\":{\"OVER_UNDER_25\":{\"marketId\":\"1.115036531\",\"marketName\":\"Over/Under 2.5 Goals\",\"description\":{\"persistenceEnabled\":true,\"bspMarket\":false,\"marketTime\":\"Aug 25, 2014 8:00:00 PM\",\"suspendTime\":\"Aug 25, 2014 8:00:00 PM\",\"bettingType\":\"ODDS\",\"turnInPlayEnabled\":true,\"marketType\":\"OVER_UNDER_25\",\"marketBaseRate\":5.0,\"discountAllowed\":true,\"wallet\":\"UK wallet\",\"rules\":\"\",\"rulesHasDate\":true},\"runners\":[{\"selectionId\":47972,\"runnerName\":\"Under 2.5 Goals\",\"handicap\":0.0},{\"selectionId\":47973,\"runnerName\":\"Over 2.5 Goals\",\"handicap\":0.0}],\"competition\":{\"id\":\"31\",\"name\":\"Barclays Premier League\"},\"event\":{\"id\":\"27249641\",\"name\":\"Man City v Liverpool\",\"countryCode\":\"GB\",\"timezone\":\"Europe/London\",\"openDate\":\"Aug 25, 2014 8:00:00 PM\",\"market\":{}},\"marketBook\":{\"marketId\":\"1.115036531\",\"isMarketDataDelayed\":false,\"status\":\"OPEN\",\"betDelay\":5,\"bspReconciled\":false,\"complete\":true,\"inplay\":true,\"numberOfWinners\":1,\"numberOfRunners\":2,\"numberOfActiveRunners\":2,\"lastMatchTime\":\"Aug 25, 2014 9:06:51 PM\",\"totalMatched\":2317163.2,\"totalAvailable\":372363.45,\"crossMatching\":true,\"runnersVoidable\":false,\"version\":803963784,\"runners\":[{\"selectionId\":47972,\"handicap\":0.0,\"status\":\"ACTIVE\",\"lastPriceTraded\":1.77,\"totalMatched\":1026679.77,\"ex\":{\"availableToBack\":[{\"price\":1.76,\"size\":189.53},{\"price\":1.75,\"size\":155.93},{\"price\":1.74,\"size\":861.57}],\"availableToLay\":[{\"price\":1.77,\"size\":421.13},{\"price\":1.78,\"size\":347.01},{\"price\":1.79,\"size\":2268.39}],\"tradedVolume\":[]},\"orders\":[{\"betId\":\"40512000858\",\"orderType\":\"LIMIT\",\"status\":\"EXECUTION_COMPLETE\",\"persistenceType\":\"LAPSE\",\"side\":\"LAY\",\"price\":1.98,\"size\":2.0,\"bspLiability\":0.0,\"placedDate\":\"Aug 25, 2014 8:15:54 PM\",\"avgPriceMatched\":1.98,\"sizeMatched\":2.0,\"sizeRemaining\":0.0,\"sizeLapsed\":0.0,\"sizeCancelled\":0.0,\"sizeVoided\":0.0},{\"betId\":\"40509052837\",\"orderType\":\"LIMIT\",\"status\":\"EXECUTION_COMPLETE\",\"persistenceType\":\"LAPSE\",\"side\":\"BACK\",\"price\":2.42,\"size\":2.0,\"bspLiability\":0.0,\"placedDate\":\"Aug 25, 2014 7:21:00 PM\",\"avgPriceMatched\":2.42,\"sizeMatched\":2.0,\"sizeRemaining\":0.0,\"sizeLapsed\":0.0,\"sizeCancelled\":0.0,\"sizeVoided\":0.0},{\"betId\":\"40512132625\",\"orderType\":\"LIMIT\",\"status\":\"EXECUTION_COMPLETE\",\"persistenceType\":\"LAPSE\",\"side\":\"LAY\",\"price\":1.95,\"size\":0.46,\"bspLiability\":0.0,\"placedDate\":\"Aug 25, 2014 8:18:22 PM\",\"avgPriceMatched\":1.94,\"sizeMatched\":0.46,\"sizeRemaining\":0.0,\"sizeLapsed\":0.0,\"sizeCancelled\":0.0,\"sizeVoided\":0.0}],\"matches\":[]},{\"selectionId\":47973,\"handicap\":0.0,\"status\":\"ACTIVE\",\"lastPriceTraded\":2.3,\"totalMatched\":1290483.43,\"ex\":{\"availableToBack\":[{\"price\":2.3,\"size\":55.84},{\"price\":2.26,\"size\":42.96},{\"price\":2.24,\"size\":637.68}],\"availableToLay\":[{\"price\":2.32,\"size\":255.88},{\"price\":2.34,\"size\":754.01},{\"price\":2.36,\"size\":708.08}],\"tradedVolume\":[]}}]}},\"CORRECT_SCORE\":{\"marketId\":\"1.115036530\",\"marketName\":\"Correct Score\",\"description\":{\"persistenceEnabled\":true,\"bspMarket\":false,\"marketTime\":\"Aug 25, 2014 8:00:00 PM\",\"suspendTime\":\"Aug 25, 2014 8:00:00 PM\",\"bettingType\":\"ODDS\",\"turnInPlayEnabled\":true,\"marketType\":\"CORRECT_SCORE\",\"marketBaseRate\":5.0,\"discountAllowed\":true,\"wallet\":\"UK wallet\",\"rules\":\"\",\"rulesHasDate\":true},\"runners\":[{\"selectionId\":1,\"runnerName\":\"0 - 0\",\"handicap\":0.0},{\"selectionId\":4,\"runnerName\":\"0 - 1\",\"handicap\":0.0},{\"selectionId\":9,\"runnerName\":\"0 - 2\",\"handicap\":0.0},{\"selectionId\":16,\"runnerName\":\"0 - 3\",\"handicap\":0.0},{\"selectionId\":2,\"runnerName\":\"1 - 0\",\"handicap\":0.0},{\"selectionId\":3,\"runnerName\":\"1 - 1\",\"handicap\":0.0},{\"selectionId\":8,\"runnerName\":\"1 - 2\",\"handicap\":0.0},{\"selectionId\":15,\"runnerName\":\"1 - 3\",\"handicap\":0.0},{\"selectionId\":5,\"runnerName\":\"2 - 0\",\"handicap\":0.0},{\"selectionId\":6,\"runnerName\":\"2 - 1\",\"handicap\":0.0},{\"selectionId\":7,\"runnerName\":\"2 - 2\",\"handicap\":0.0},{\"selectionId\":14,\"runnerName\":\"2 - 3\",\"handicap\":0.0},{\"selectionId\":10,\"runnerName\":\"3 - 0\",\"handicap\":0.0},{\"selectionId\":11,\"runnerName\":\"3 - 1\",\"handicap\":0.0},{\"selectionId\":12,\"runnerName\":\"3 - 2\",\"handicap\":0.0},{\"selectionId\":13,\"runnerName\":\"3 - 3\",\"handicap\":0.0},{\"selectionId\":4506345,\"runnerName\":\"Any Unquoted \",\"handicap\":0.0}],\"competition\":{\"id\":\"31\",\"name\":\"Barclays Premier League\"},\"event\":{\"id\":\"27249641\",\"name\":\"Man City v Liverpool\",\"countryCode\":\"GB\",\"timezone\":\"Europe/London\",\"openDate\":\"Aug 25, 2014 8:00:00 PM\",\"market\":{}},\"marketBook\":{\"marketId\":\"1.115036530\",\"isMarketDataDelayed\":false,\"status\":\"OPEN\",\"betDelay\":5,\"bspReconciled\":false,\"complete\":true,\"inplay\":true,\"numberOfWinners\":1,\"numberOfRunners\":17,\"numberOfActiveRunners\":17,\"lastMatchTime\":\"Aug 25, 2014 9:06:50 PM\",\"totalMatched\":1056150.66,\"totalAvailable\":55756.48,\"crossMatching\":true,\"runnersVoidable\":false,\"version\":803963684,\"runners\":[{\"selectionId\":1,\"handicap\":0.0,\"status\":\"ACTIVE\",\"lastPriceTraded\":1000.0,\"totalMatched\":212854.34,\"ex\":{\"availableToBack\":[{\"price\":1000.0,\"size\":57.93},{\"price\":200.0,\"size\":15.0},{\"price\":100.0,\"size\":2.0}],\"availableToLay\":[],\"tradedVolume\":[]}},{\"selectionId\":4,\"handicap\":0.0,\"status\":\"ACTIVE\",\"lastPriceTraded\":1000.0,\"totalMatched\":45845.25,\"ex\":{\"availableToBack\":[{\"price\":1000.0,\"size\":33.57},{\"price\":200.0,\"size\":15.0},{\"price\":100.0,\"size\":2.0}],\"availableToLay\":[],\"tradedVolume\":[]}},{\"selectionId\":9,\"handicap\":0.0,\"status\":\"ACTIVE\",\"lastPriceTraded\":1000.0,\"totalMatched\":19937.85,\"ex\":{\"availableToBack\":[{\"price\":1000.0,\"size\":49.13},{\"price\":200.0,\"size\":15.0},{\"price\":100.0,\"size\":2.0}],\"availableToLay\":[],\"tradedVolume\":[]}},{\"selectionId\":16,\"handicap\":0.0,\"status\":\"ACTIVE\",\"lastPriceTraded\":1000.0,\"totalMatched\":7411.19,\"ex\":{\"availableToBack\":[{\"price\":1000.0,\"size\":18.23},{\"price\":200.0,\"size\":15.0},{\"price\":100.0,\"size\":2.0}],\"availableToLay\":[],\"tradedVolume\":[]}},{\"selectionId\":2,\"handicap\":0.0,\"status\":\"ACTIVE\",\"lastPriceTraded\":4.7,\"totalMatched\":138170.61,\"ex\":{\"availableToBack\":[{\"price\":4.7,\"size\":257.09},{\"price\":4.6,\"size\":909.9},{\"price\":4.5,\"size\":385.42}],\"availableToLay\":[{\"price\":4.8,\"size\":39.93},{\"price\":4.9,\"size\":1151.73},{\"price\":5.0,\"size\":550.18}],\"tradedVolume\":[]}},{\"selectionId\":3,\"handicap\":0.0,\"status\":\"ACTIVE\",\"lastPriceTraded\":7.0,\"totalMatched\":113601.26,\"ex\":{\"availableToBack\":[{\"price\":7.0,\"size\":604.74},{\"price\":6.8,\"size\":835.19},{\"price\":6.6,\"size\":202.35}],\"availableToLay\":[{\"price\":7.2,\"size\":127.7},{\"price\":7.4,\"size\":18.35},{\"price\":7.6,\"size\":518.28}],\"tradedVolume\":[]}},{\"selectionId\":8,\"handicap\":0.0,\"status\":\"ACTIVE\",\"lastPriceTraded\":19.0,\"totalMatched\":44039.61,\"ex\":{\"availableToBack\":[{\"price\":19.0,\"size\":110.86},{\"price\":18.5,\"size\":25.54},{\"price\":18.0,\"size\":6.36}],\"availableToLay\":[{\"price\":19.5,\"size\":2.0},{\"price\":20.0,\"size\":13.97},{\"price\":21.0,\"size\":21.54}],\"tradedVolume\":[]}},{\"selectionId\":15,\"handicap\":0.0,\"status\":\"ACTIVE\",\"lastPriceTraded\":95.0,\"totalMatched\":14892.05,\"ex\":{\"availableToBack\":[{\"price\":90.0,\"size\":15.83},{\"price\":75.0,\"size\":17.9},{\"price\":70.0,\"size\":17.29}],\"availableToLay\":[{\"price\":95.0,\"size\":27.41},{\"price\":100.0,\"size\":17.13},{\"price\":120.0,\"size\":3.4}],\"tradedVolume\":[]}},{\"selectionId\":5,\"handicap\":0.0,\"status\":\"ACTIVE\",\"lastPriceTraded\":5.0,\"totalMatched\":90201.23,\"ex\":{\"availableToBack\":[{\"price\":4.9,\"size\":876.8},{\"price\":4.8,\"size\":79.79},{\"price\":4.7,\"size\":98.86}],\"availableToLay\":[{\"price\":5.0,\"size\":94.87},{\"price\":5.1,\"size\":156.02},{\"price\":5.2,\"size\":303.75}],\"tradedVolume\":[]}},{\"selectionId\":6,\"handicap\":0.0,\"status\":\"ACTIVE\",\"lastPriceTraded\":7.8,\"totalMatched\":95347.86,\"ex\":{\"availableToBack\":[{\"price\":7.8,\"size\":5.22},{\"price\":7.6,\"size\":928.66},{\"price\":7.4,\"size\":227.76}],\"availableToLay\":[{\"price\":8.0,\"size\":43.24},{\"price\":8.2,\"size\":44.78},{\"price\":8.4,\"size\":39.78}],\"tradedVolume\":[]}},{\"selectionId\":7,\"handicap\":0.0,\"status\":\"ACTIVE\",\"lastPriceTraded\":27.0,\"totalMatched\":66994.13,\"ex\":{\"availableToBack\":[{\"price\":25.0,\"size\":4.26},{\"price\":24.0,\"size\":105.72},{\"price\":23.0,\"size\":183.28}],\"availableToLay\":[{\"price\":27.0,\"size\":33.44},{\"price\":28.0,\"size\":4.02},{\"price\":30.0,\"size\":148.32}],\"tradedVolume\":[]}},{\"selectionId\":14,\"handicap\":0.0,\"status\":\"ACTIVE\",\"lastPriceTraded\":150.0,\"totalMatched\":13540.28,\"ex\":{\"availableToBack\":[{\"price\":120.0,\"size\":17.56},{\"price\":110.0,\"size\":5.36},{\"price\":100.0,\"size\":28.87}],\"availableToLay\":[{\"price\":150.0,\"size\":18.77},{\"price\":190.0,\"size\":2.0}],\"tradedVolume\":[]}},{\"selectionId\":10,\"handicap\":0.0,\"status\":\"ACTIVE\",\"lastPriceTraded\":13.0,\"totalMatched\":40802.35,\"ex\":{\"availableToBack\":[{\"price\":11.5,\"size\":5.0},{\"price\":11.0,\"size\":133.26},{\"price\":10.5,\"size\":502.93}],\"availableToLay\":[{\"price\":12.0,\"size\":3.2},{\"price\":13.0,\"size\":552.01},{\"price\":14.0,\"size\":20.0}],\"tradedVolume\":[]}},{\"selectionId\":11,\"handicap\":0.0,\"status\":\"ACTIVE\",\"lastPriceTraded\":17.5,\"totalMatched\":48827.7,\"ex\":{\"availableToBack\":[{\"price\":17.0,\"size\":14.47},{\"price\":16.5,\"size\":269.45},{\"price\":16.0,\"size\":150.25}],\"availableToLay\":[{\"price\":19.0,\"size\":6.0},{\"price\":20.0,\"size\":93.94},{\"price\":21.0,\"size\":148.9}],\"tradedVolume\":[]}},{\"selectionId\":12,\"handicap\":0.0,\"status\":\"ACTIVE\",\"lastPriceTraded\":60.0,\"totalMatched\":23953.79,\"ex\":{\"availableToBack\":[{\"price\":55.0,\"size\":10.22},{\"price\":50.0,\"size\":33.59},{\"price\":48.0,\"size\":25.38}],\"availableToLay\":[{\"price\":65.0,\"size\":63.0},{\"price\":95.0,\"size\":3.0}],\"tradedVolume\":[]}},{\"selectionId\":13,\"handicap\":0.0,\"status\":\"ACTIVE\",\"lastPriceTraded\":310.0,\"totalMatched\":11802.6,\"ex\":{\"availableToBack\":[{\"price\":300.0,\"size\":2.0},{\"price\":290.0,\"size\":9.77},{\"price\":250.0,\"size\":3.59}],\"availableToLay\":[{\"price\":440.0,\"size\":2.65},{\"price\":450.0,\"size\":26.28},{\"price\":970.0,\"size\":3.04}],\"tradedVolume\":[]}},{\"selectionId\":4506345,\"handicap\":0.0,\"status\":\"ACTIVE\",\"lastPriceTraded\":17.0,\"totalMatched\":67928.48,\"ex\":{\"availableToBack\":[{\"price\":17.0,\"size\":105.6},{\"price\":15.5,\"size\":101.05},{\"price\":15.0,\"size\":243.2}],\"availableToLay\":[{\"price\":17.5,\"size\":19.05},{\"price\":18.0,\"size\":17.1},{\"price\":19.0,\"size\":2.1}],\"tradedVolume\":[]}}]}}}}";
    Gson gson = new Gson();

    @Test
    public void exposureTest() throws Exception {
        Event event = gson.fromJson(jsonEvent, Event.class);
        OverUnderMarket ouc = new OverUnderMarket(event.getMarket().get(MarketType.OVER_UNDER_25));

        MarketCatalogue mc = event.getMarket().get(MarketType.OVER_UNDER_25);
        MarketBook mb = mc.getMarketBook();

        Runner r = ouc.getUnderRunner();

        Exposure exposure = new Exposure(event, mc);

        PriceSize priceSize = new PriceSize();
        priceSize.setPrice(4.1d);
        priceSize.setSize(2d);

        Bet placedBet = new Bet();
        placedBet.setPriceSize(priceSize);
        placedBet.setSide(Side.BACK);
        placedBet.setMarketId(mb.getMarketId());
        placedBet.setSelectionId(r.getSelectionId());

        Bet cob = exposure.calcCashOutBet(placedBet, 10d);
        assertEquals(3.7d, cob.getPriceSize().getPrice(), 0);
        assertEquals(2.21d, cob.getPriceSize().getSize(), 0);
        assertEquals(Side.LAY, cob.getSide());
        assertEquals(mc.getMarketId(), cob.getMarketId());
        assertEquals(r.getSelectionId(), cob.getSelectionId());
    }

    @Test
    public void roundingTest() {
        Double val = 1.9090909090d;
        val = 21.4823;

        logger.info(roundDownToNearestFraction(val, 0.01).toString());
        logger.info(roundDownToNearestFraction(val, 0.02).toString());
        logger.info(roundDownToNearestFraction(val, 0.05).toString());
        logger.info(roundDownToNearestFraction(val, 0.1).toString());
        logger.info(roundDownToNearestFraction(val, 0.2).toString());
        logger.info(roundDownToNearestFraction(val, 0.5).toString());
        logger.info(roundDownToNearestFraction(val, 1.0).toString());
        logger.info(roundDownToNearestFraction(val, 2.0).toString());

        logger.info("");

        logger.info(roundUpToNearestFraction(val, 0.01).toString());
        logger.info(roundUpToNearestFraction(val, 0.02).toString());
        logger.info(roundUpToNearestFraction(val, 0.05).toString());
        logger.info(roundUpToNearestFraction(val, 0.1).toString());
        logger.info(roundUpToNearestFraction(val, 0.2).toString());
        logger.info(roundUpToNearestFraction(val, 0.5).toString());
        logger.info(roundUpToNearestFraction(val, 1.0).toString());
        logger.info(roundUpToNearestFraction(val, 2.0).toString());
    }

    @Test
    public void layTheDrawTest() throws Exception {
        String jsonEvent = "{\"id\":\"27323365\",\"name\":\"QPR v Sheff Utd\",\"countryCode\":\"GB\",\"timezone\":\"Europe/London\",\"openDate\":\"Jan 4, 2015 1:00:00 PM\",\"score\":\"NIL_TWO\",\"previousScores\":[\"NIL_TWO\",\"NIL_TWO\",\"NIL_TWO\",\"NIL_TWO\",\"NIL_TWO\",\"NIL_TWO\"],\"market\":{\"MATCH_ODDS\":{\"marketId\":\"1.116674701\",\"marketName\":\"Match Odds\",\"description\":{\"persistenceEnabled\":true,\"bspMarket\":false,\"marketTime\":\"Jan 4, 2015 1:00:00 PM\",\"suspendTime\":\"Jan 4, 2015 1:00:00 PM\",\"bettingType\":\"ODDS\",\"turnInPlayEnabled\":true,\"marketType\":\"MATCH_ODDS\",\"regulator\":\"GIBRALTAR REGULATOR\",\"marketBaseRate\":5.0,\"discountAllowed\":true,\"wallet\":\"UK wallet\",\"rules\":\"\",\"rulesHasDate\":true},\"runners\":[{\"selectionId\":62684,\"runnerName\":\"QPR\",\"handicap\":0.0},{\"selectionId\":48470,\"runnerName\":\"Sheff Utd\",\"handicap\":0.0},{\"selectionId\":58805,\"runnerName\":\"The Draw\",\"handicap\":0.0}],\"competition\":{\"id\":\"30558\",\"name\":\"English FA Cup\"},\"event\":{\"id\":\"27323365\",\"name\":\"QPR v Sheff Utd\",\"countryCode\":\"GB\",\"timezone\":\"Europe/London\",\"openDate\":\"Jan 4, 2015 1:00:00 PM\",\"score\":\"NIL_NIL\",\"previousScores\":[],\"market\":{}},\"marketBook\":{\"marketId\":\"1.116674701\",\"isMarketDataDelayed\":false,\"status\":\"OPEN\",\"betDelay\":8,\"bspReconciled\":false,\"complete\":true,\"inplay\":true,\"numberOfWinners\":1,\"numberOfRunners\":3,\"numberOfActiveRunners\":3,\"lastMatchTime\":\"Jan 4, 2015 2:35:47 PM\",\"totalMatched\":895008.76,\"totalAvailable\":48797.95,\"crossMatching\":true,\"runnersVoidable\":false,\"version\":890930028,\"runners\":[{\"selectionId\":62684,\"handicap\":0.0,\"status\":\"ACTIVE\",\"lastPriceTraded\":190.0,\"totalMatched\":474493.98,\"ex\":{\"availableToBack\":[{\"price\":170.0,\"size\":2.34},{\"price\":150.0,\"size\":11.04},{\"price\":120.0,\"size\":2.0}],\"availableToLay\":[{\"price\":400.0,\"size\":6.57},{\"price\":1000.0,\"size\":2.93}],\"tradedVolume\":[]}},{\"selectionId\":48470,\"handicap\":0.0,\"status\":\"ACTIVE\",\"lastPriceTraded\":1.05,\"totalMatched\":356275.25,\"ex\":{\"availableToBack\":[{\"price\":1.04,\"size\":3263.99},{\"price\":1.03,\"size\":7567.79},{\"price\":1.02,\"size\":7210.97}],\"availableToLay\":[{\"price\":1.05,\"size\":10446.46},{\"price\":1.06,\"size\":2651.06},{\"price\":1.07,\"size\":591.94}],\"tradedVolume\":[]}},{\"selectionId\":58805,\"handicap\":0.0,\"status\":\"ACTIVE\",\"lastPriceTraded\":23.0,\"totalMatched\":64239.53,\"ex\":{\"availableToBack\":[{\"price\":22.0,\"size\":29.89},{\"price\":21.0,\"size\":6.64},{\"price\":20.0,\"size\":80.88}],\"availableToLay\":[{\"price\":32.0,\"size\":11.13},{\"price\":34.0,\"size\":26.62},{\"price\":36.0,\"size\":21.92}],\"tradedVolume\":[]},\"orders\":[{\"betId\":\"44982512585\",\"orderType\":\"LIMIT\",\"status\":\"EXECUTION_COMPLETE\",\"persistenceType\":\"PERSIST\",\"side\":\"BACK\",\"price\":3.2,\"size\":2.0,\"bspLiability\":0.0,\"placedDate\":\"Jan 4, 2015 1:44:15 PM\",\"avgPriceMatched\":3.2,\"sizeMatched\":2.0,\"sizeRemaining\":0.0,\"sizeLapsed\":0.0,\"sizeCancelled\":0.0,\"sizeVoided\":0.0},{\"betId\":\"44981661317\",\"orderType\":\"LIMIT\",\"status\":\"EXECUTION_COMPLETE\",\"persistenceType\":\"PERSIST\",\"side\":\"LAY\",\"price\":3.1,\"size\":2.0,\"bspLiability\":0.0,\"placedDate\":\"Jan 4, 2015 1:28:17 PM\",\"avgPriceMatched\":3.05,\"sizeMatched\":2.0,\"sizeRemaining\":0.0,\"sizeLapsed\":0.0,\"sizeCancelled\":0.0,\"sizeVoided\":0.0},{\"betId\":\"44982255133\",\"orderType\":\"LIMIT\",\"status\":\"EXECUTION_COMPLETE\",\"persistenceType\":\"LAPSE\",\"side\":\"LAY\",\"price\":3.3,\"size\":1.97,\"bspLiability\":0.0,\"placedDate\":\"Jan 4, 2015 1:39:26 PM\",\"avgPriceMatched\":3.3,\"sizeMatched\":1.97,\"sizeRemaining\":0.0,\"sizeLapsed\":0.0,\"sizeCancelled\":0.0,\"sizeVoided\":0.0},{\"betId\":\"44981635708\",\"orderType\":\"LIMIT\",\"status\":\"EXECUTION_COMPLETE\",\"persistenceType\":\"PERSIST\",\"side\":\"LAY\",\"price\":3.1,\"size\":2.0,\"bspLiability\":0.0,\"placedDate\":\"Jan 4, 2015 1:27:54 PM\",\"avgPriceMatched\":3.1,\"sizeMatched\":2.0,\"sizeRemaining\":0.0,\"sizeLapsed\":0.0,\"sizeCancelled\":0.0,\"sizeVoided\":0.0},{\"betId\":\"44982615239\",\"orderType\":\"LIMIT\",\"status\":\"EXECUTION_COMPLETE\",\"persistenceType\":\"LAPSE\",\"side\":\"LAY\",\"price\":3.3,\"size\":1.94,\"bspLiability\":0.0,\"placedDate\":\"Jan 4, 2015 1:46:29 PM\",\"avgPriceMatched\":3.3,\"sizeMatched\":1.94,\"sizeRemaining\":0.0,\"sizeLapsed\":0.0,\"sizeCancelled\":0.0,\"sizeVoided\":0.0},{\"betId\":\"44982328670\",\"orderType\":\"LIMIT\",\"status\":\"EXECUTION_COMPLETE\",\"persistenceType\":\"PERSIST\",\"side\":\"BACK\",\"price\":3.2,\"size\":2.0,\"bspLiability\":0.0,\"placedDate\":\"Jan 4, 2015 1:40:51 PM\",\"avgPriceMatched\":3.25,\"sizeMatched\":2.0,\"sizeRemaining\":0.0,\"sizeLapsed\":0.0,\"sizeCancelled\":0.0,\"sizeVoided\":0.0},{\"betId\":\"44982387822\",\"orderType\":\"LIMIT\",\"status\":\"EXECUTION_COMPLETE\",\"persistenceType\":\"LAPSE\",\"side\":\"LAY\",\"price\":3.3,\"size\":1.97,\"bspLiability\":0.0,\"placedDate\":\"Jan 4, 2015 1:41:55 PM\",\"avgPriceMatched\":3.3,\"sizeMatched\":1.97,\"sizeRemaining\":0.0,\"sizeLapsed\":0.0,\"sizeCancelled\":0.0,\"sizeVoided\":0.0},{\"betId\":\"44982113194\",\"orderType\":\"LIMIT\",\"status\":\"EXECUTION_COMPLETE\",\"persistenceType\":\"LAPSE\",\"side\":\"BACK\",\"price\":3.2,\"size\":5.78,\"bspLiability\":0.0,\"placedDate\":\"Jan 4, 2015 1:36:30 PM\",\"avgPriceMatched\":3.2,\"sizeMatched\":5.78,\"sizeRemaining\":0.0,\"sizeLapsed\":0.0,\"sizeCancelled\":0.0,\"sizeVoided\":0.0},{\"betId\":\"44981682174\",\"orderType\":\"LIMIT\",\"status\":\"EXECUTION_COMPLETE\",\"persistenceType\":\"PERSIST\",\"side\":\"LAY\",\"price\":3.1,\"size\":2.0,\"bspLiability\":0.0,\"placedDate\":\"Jan 4, 2015 1:28:41 PM\",\"avgPriceMatched\":3.1,\"sizeMatched\":2.0,\"sizeRemaining\":0.0,\"sizeLapsed\":0.0,\"sizeCancelled\":0.0,\"sizeVoided\":0.0},{\"betId\":\"44982219735\",\"orderType\":\"LIMIT\",\"status\":\"EXECUTION_COMPLETE\",\"persistenceType\":\"PERSIST\",\"side\":\"BACK\",\"price\":3.2,\"size\":2.0,\"bspLiability\":0.0,\"placedDate\":\"Jan 4, 2015 1:38:40 PM\",\"avgPriceMatched\":3.25,\"sizeMatched\":2.0,\"sizeRemaining\":0.0,\"sizeLapsed\":0.0,\"sizeCancelled\":0.0,\"sizeVoided\":0.0}],\"matches\":[]}]}},\"CORRECT_SCORE\":{\"marketId\":\"1.116825931\",\"marketName\":\"Correct Score\",\"description\":{\"persistenceEnabled\":true,\"bspMarket\":false,\"marketTime\":\"Jan 4, 2015 1:00:00 PM\",\"suspendTime\":\"Jan 4, 2015 1:00:00 PM\",\"bettingType\":\"ODDS\",\"turnInPlayEnabled\":true,\"marketType\":\"CORRECT_SCORE\",\"regulator\":\"GIBRALTAR REGULATOR\",\"marketBaseRate\":5.0,\"discountAllowed\":true,\"wallet\":\"UK wallet\",\"rules\":\"\",\"rulesHasDate\":true},\"runners\":[{\"selectionId\":1,\"runnerName\":\"0 - 0\",\"handicap\":0.0},{\"selectionId\":4,\"runnerName\":\"0 - 1\",\"handicap\":0.0},{\"selectionId\":9,\"runnerName\":\"0 - 2\",\"handicap\":0.0},{\"selectionId\":16,\"runnerName\":\"0 - 3\",\"handicap\":0.0},{\"selectionId\":2,\"runnerName\":\"1 - 0\",\"handicap\":0.0},{\"selectionId\":3,\"runnerName\":\"1 - 1\",\"handicap\":0.0},{\"selectionId\":8,\"runnerName\":\"1 - 2\",\"handicap\":0.0},{\"selectionId\":15,\"runnerName\":\"1 - 3\",\"handicap\":0.0},{\"selectionId\":5,\"runnerName\":\"2 - 0\",\"handicap\":0.0},{\"selectionId\":6,\"runnerName\":\"2 - 1\",\"handicap\":0.0},{\"selectionId\":7,\"runnerName\":\"2 - 2\",\"handicap\":0.0},{\"selectionId\":14,\"runnerName\":\"2 - 3\",\"handicap\":0.0},{\"selectionId\":10,\"runnerName\":\"3 - 0\",\"handicap\":0.0},{\"selectionId\":11,\"runnerName\":\"3 - 1\",\"handicap\":0.0},{\"selectionId\":12,\"runnerName\":\"3 - 2\",\"handicap\":0.0},{\"selectionId\":13,\"runnerName\":\"3 - 3\",\"handicap\":0.0},{\"selectionId\":9063254,\"runnerName\":\"Any Other Home Win\",\"handicap\":0.0},{\"selectionId\":9063255,\"runnerName\":\"Any Other Away Win\",\"handicap\":0.0},{\"selectionId\":9063256,\"runnerName\":\"Any Other Draw\",\"handicap\":0.0}],\"competition\":{\"id\":\"30558\",\"name\":\"English FA Cup\"},\"event\":{\"id\":\"27323365\",\"name\":\"QPR v Sheff Utd\",\"countryCode\":\"GB\",\"timezone\":\"Europe/London\",\"openDate\":\"Jan 4, 2015 1:00:00 PM\",\"score\":\"NIL_NIL\",\"previousScores\":[],\"market\":{}},\"marketBook\":{\"marketId\":\"1.116825931\",\"isMarketDataDelayed\":false,\"status\":\"OPEN\",\"betDelay\":8,\"bspReconciled\":false,\"complete\":true,\"inplay\":true,\"numberOfWinners\":1,\"numberOfRunners\":19,\"numberOfActiveRunners\":19,\"lastMatchTime\":\"Jan 4, 2015 2:35:44 PM\",\"totalMatched\":60103.58,\"totalAvailable\":13813.8,\"crossMatching\":true,\"runnersVoidable\":false,\"version\":890930019,\"runners\":[{\"selectionId\":1,\"handicap\":0.0,\"status\":\"ACTIVE\",\"lastPriceTraded\":1000.0,\"totalMatched\":11752.28,\"ex\":{\"availableToBack\":[{\"price\":1000.0,\"size\":10.58},{\"price\":110.0,\"size\":5.0},{\"price\":4.7,\"size\":113.0}],\"availableToLay\":[],\"tradedVolume\":[]}},{\"selectionId\":4,\"handicap\":0.0,\"status\":\"ACTIVE\",\"lastPriceTraded\":1000.0,\"totalMatched\":6416.82,\"ex\":{\"availableToBack\":[{\"price\":1000.0,\"size\":8.1},{\"price\":1.25,\"size\":32.62},{\"price\":1.2,\"size\":5.29}],\"availableToLay\":[],\"tradedVolume\":[]}},{\"selectionId\":9,\"handicap\":0.0,\"status\":\"ACTIVE\",\"lastPriceTraded\":1.65,\"totalMatched\":10980.91,\"ex\":{\"availableToBack\":[{\"price\":1.6,\"size\":77.87},{\"price\":1.59,\"size\":1525.45},{\"price\":1.57,\"size\":1444.92}],\"availableToLay\":[{\"price\":1.65,\"size\":2.86},{\"price\":1.66,\"size\":62.0},{\"price\":1.67,\"size\":53.24}],\"tradedVolume\":[]}},{\"selectionId\":16,\"handicap\":0.0,\"status\":\"ACTIVE\",\"lastPriceTraded\":10.0,\"totalMatched\":1432.58,\"ex\":{\"availableToBack\":[{\"price\":10.0,\"size\":69.57},{\"price\":9.8,\"size\":18.17},{\"price\":9.6,\"size\":18.02}],\"availableToLay\":[{\"price\":11.0,\"size\":154.37},{\"price\":11.5,\"size\":73.15},{\"price\":12.0,\"size\":80.65}],\"tradedVolume\":[]}},{\"selectionId\":2,\"handicap\":0.0,\"status\":\"ACTIVE\",\"lastPriceTraded\":1000.0,\"totalMatched\":2458.74,\"ex\":{\"availableToBack\":[{\"price\":1000.0,\"size\":10.57},{\"price\":110.0,\"size\":5.0},{\"price\":1.02,\"size\":75.4}],\"availableToLay\":[],\"tradedVolume\":[]}},{\"selectionId\":3,\"handicap\":0.0,\"status\":\"ACTIVE\",\"lastPriceTraded\":3.9,\"totalMatched\":6750.16,\"ex\":{\"availableToBack\":[{\"price\":1000.0,\"size\":8.48},{\"price\":2.0,\"size\":15.0},{\"price\":1.02,\"size\":75.4}],\"availableToLay\":[],\"tradedVolume\":[]}},{\"selectionId\":8,\"handicap\":0.0,\"status\":\"ACTIVE\",\"lastPriceTraded\":4.8,\"totalMatched\":3630.38,\"ex\":{\"availableToBack\":[{\"price\":4.5,\"size\":133.74},{\"price\":4.4,\"size\":355.15},{\"price\":4.3,\"size\":353.42}],\"availableToLay\":[{\"price\":4.8,\"size\":273.17},{\"price\":4.9,\"size\":123.11},{\"price\":5.1,\"size\":190.28}],\"tradedVolume\":[]}},{\"selectionId\":15,\"handicap\":0.0,\"status\":\"ACTIVE\",\"lastPriceTraded\":32.0,\"totalMatched\":690.22,\"ex\":{\"availableToBack\":[{\"price\":30.0,\"size\":23.0},{\"price\":27.0,\"size\":26.44},{\"price\":26.0,\"size\":52.56}],\"availableToLay\":[{\"price\":38.0,\"size\":4.69},{\"price\":40.0,\"size\":19.57},{\"price\":44.0,\"size\":18.01}],\"tradedVolume\":[]}},{\"selectionId\":5,\"handicap\":0.0,\"status\":\"ACTIVE\",\"lastPriceTraded\":10.5,\"totalMatched\":2530.41,\"ex\":{\"availableToBack\":[{\"price\":1000.0,\"size\":10.57},{\"price\":110.0,\"size\":5.0},{\"price\":1.02,\"size\":65.4}],\"availableToLay\":[],\"tradedVolume\":[]}},{\"selectionId\":6,\"handicap\":0.0,\"status\":\"ACTIVE\",\"lastPriceTraded\":8.2,\"totalMatched\":2598.01,\"ex\":{\"availableToBack\":[{\"price\":1000.0,\"size\":8.47},{\"price\":1.02,\"size\":65.4},{\"price\":1.01,\"size\":107.66}],\"availableToLay\":[],\"tradedVolume\":[]}},{\"selectionId\":7,\"handicap\":0.0,\"status\":\"ACTIVE\",\"lastPriceTraded\":29.0,\"totalMatched\":2345.88,\"ex\":{\"availableToBack\":[{\"price\":23.0,\"size\":31.25},{\"price\":22.0,\"size\":28.48},{\"price\":21.0,\"size\":2.0}],\"availableToLay\":[{\"price\":30.0,\"size\":32.23},{\"price\":32.0,\"size\":42.83},{\"price\":34.0,\"size\":26.62}],\"tradedVolume\":[]}},{\"selectionId\":14,\"handicap\":0.0,\"status\":\"ACTIVE\",\"lastPriceTraded\":210.0,\"totalMatched\":557.28,\"ex\":{\"availableToBack\":[{\"price\":140.0,\"size\":5.13},{\"price\":130.0,\"size\":5.33},{\"price\":120.0,\"size\":7.77}],\"availableToLay\":[],\"tradedVolume\":[]}},{\"selectionId\":10,\"handicap\":0.0,\"status\":\"ACTIVE\",\"lastPriceTraded\":28.0,\"totalMatched\":1224.94,\"ex\":{\"availableToBack\":[{\"price\":1000.0,\"size\":10.57},{\"price\":110.0,\"size\":5.0},{\"price\":1.02,\"size\":65.4}],\"availableToLay\":[],\"tradedVolume\":[]}},{\"selectionId\":11,\"handicap\":0.0,\"status\":\"ACTIVE\",\"lastPriceTraded\":28.0,\"totalMatched\":2148.07,\"ex\":{\"availableToBack\":[{\"price\":1000.0,\"size\":8.47},{\"price\":1.02,\"size\":65.4},{\"price\":1.01,\"size\":107.66}],\"availableToLay\":[],\"tradedVolume\":[]}},{\"selectionId\":12,\"handicap\":0.0,\"status\":\"ACTIVE\",\"lastPriceTraded\":300.0,\"totalMatched\":1353.78,\"ex\":{\"availableToBack\":[{\"price\":180.0,\"size\":3.89},{\"price\":170.0,\"size\":4.07},{\"price\":160.0,\"size\":6.32}],\"availableToLay\":[],\"tradedVolume\":[]}},{\"selectionId\":13,\"handicap\":0.0,\"status\":\"ACTIVE\",\"lastPriceTraded\":990.0,\"totalMatched\":560.52,\"ex\":{\"availableToBack\":[{\"price\":420.0,\"size\":2.56},{\"price\":410.0,\"size\":2.0},{\"price\":290.0,\"size\":2.0}],\"availableToLay\":[],\"tradedVolume\":[]}},{\"selectionId\":9063254,\"handicap\":0.0,\"status\":\"ACTIVE\",\"lastPriceTraded\":900.0,\"totalMatched\":2063.41,\"ex\":{\"availableToBack\":[{\"price\":1.02,\"size\":65.4},{\"price\":1.01,\"size\":107.66}],\"availableToLay\":[],\"tradedVolume\":[]}},{\"selectionId\":9063255,\"handicap\":0.0,\"status\":\"ACTIVE\",\"lastPriceTraded\":80.0,\"totalMatched\":580.86,\"ex\":{\"availableToBack\":[{\"price\":34.0,\"size\":2.05},{\"price\":30.0,\"size\":15.7},{\"price\":29.0,\"size\":31.32}],\"availableToLay\":[{\"price\":880.0,\"size\":6.64}],\"tradedVolume\":[]}},{\"selectionId\":9063256,\"handicap\":0.0,\"status\":\"ACTIVE\",\"lastPriceTraded\":990.0,\"totalMatched\":28.24,\"ex\":{\"availableToBack\":[{\"price\":38.0,\"size\":2.64},{\"price\":1.02,\"size\":65.4},{\"price\":1.01,\"size\":109.66}],\"availableToLay\":[],\"tradedVolume\":[]}}]}},\"OVER_UNDER_25\":{\"marketId\":\"1.116674702\",\"marketName\":\"Over/Under 2.5 Goals\",\"description\":{\"persistenceEnabled\":true,\"bspMarket\":false,\"marketTime\":\"Jan 4, 2015 1:00:00 PM\",\"suspendTime\":\"Jan 4, 2015 1:00:00 PM\",\"bettingType\":\"ODDS\",\"turnInPlayEnabled\":true,\"marketType\":\"OVER_UNDER_25\",\"regulator\":\"GIBRALTAR REGULATOR\",\"marketBaseRate\":5.0,\"discountAllowed\":true,\"wallet\":\"UK wallet\",\"rules\":\"\",\"rulesHasDate\":true},\"runners\":[{\"selectionId\":47972,\"runnerName\":\"Under 2.5 Goals\",\"handicap\":0.0},{\"selectionId\":47973,\"runnerName\":\"Over 2.5 Goals\",\"handicap\":0.0}],\"competition\":{\"id\":\"30558\",\"name\":\"English FA Cup\"},\"event\":{\"id\":\"27323365\",\"name\":\"QPR v Sheff Utd\",\"countryCode\":\"GB\",\"timezone\":\"Europe/London\",\"openDate\":\"Jan 4, 2015 1:00:00 PM\",\"score\":\"NIL_NIL\",\"previousScores\":[],\"market\":{}},\"marketBook\":{\"marketId\":\"1.116674702\",\"isMarketDataDelayed\":false,\"status\":\"OPEN\",\"betDelay\":8,\"bspReconciled\":false,\"complete\":true,\"inplay\":true,\"numberOfWinners\":1,\"numberOfRunners\":2,\"numberOfActiveRunners\":2,\"lastMatchTime\":\"Jan 4, 2015 2:35:45 PM\",\"totalMatched\":518258.1,\"totalAvailable\":31419.54,\"crossMatching\":true,\"runnersVoidable\":false,\"version\":890930025,\"runners\":[{\"selectionId\":47972,\"handicap\":0.0,\"status\":\"ACTIVE\",\"lastPriceTraded\":1.64,\"totalMatched\":216272.39,\"ex\":{\"availableToBack\":[{\"price\":1.63,\"size\":6.04},{\"price\":1.62,\"size\":161.12},{\"price\":1.6,\"size\":142.17}],\"availableToLay\":[{\"price\":1.64,\"size\":518.42},{\"price\":1.65,\"size\":62.1},{\"price\":1.67,\"size\":120.35}],\"tradedVolume\":[]},\"orders\":[{\"betId\":\"44981203413\",\"orderType\":\"LIMIT\",\"status\":\"EXECUTION_COMPLETE\",\"persistenceType\":\"PERSIST\",\"side\":\"LAY\",\"price\":1.47,\"size\":2.0,\"bspLiability\":0.0,\"placedDate\":\"Jan 4, 2015 1:20:14 PM\",\"avgPriceMatched\":1.47,\"sizeMatched\":2.0,\"sizeRemaining\":0.0,\"sizeLapsed\":0.0,\"sizeCancelled\":0.0,\"sizeVoided\":0.0}],\"matches\":[]},{\"selectionId\":47973,\"handicap\":0.0,\"status\":\"ACTIVE\",\"lastPriceTraded\":2.56,\"totalMatched\":301985.71,\"ex\":{\"availableToBack\":[{\"price\":2.56,\"size\":16.0},{\"price\":2.54,\"size\":7.83},{\"price\":2.52,\"size\":132.52}],\"availableToLay\":[{\"price\":2.66,\"size\":100.41},{\"price\":2.7,\"size\":68.91},{\"price\":2.74,\"size\":449.49}],\"tradedVolume\":[]},\"orders\":[{\"betId\":\"44983517114\",\"orderType\":\"LIMIT\",\"status\":\"EXECUTION_COMPLETE\",\"persistenceType\":\"PERSIST\",\"side\":\"LAY\",\"price\":1.39,\"size\":2.13,\"bspLiability\":0.0,\"placedDate\":\"Jan 4, 2015 2:05:51 PM\",\"avgPriceMatched\":1.39,\"sizeMatched\":2.13,\"sizeRemaining\":0.0,\"sizeLapsed\":0.0,\"sizeCancelled\":0.0,\"sizeVoided\":0.0}],\"matches\":[]}]}},\"OVER_UNDER_35\":{\"marketId\":\"1.116825921\",\"marketName\":\"Over/Under 3.5 Goals\",\"description\":{\"persistenceEnabled\":true,\"bspMarket\":false,\"marketTime\":\"Jan 4, 2015 1:00:00 PM\",\"suspendTime\":\"Jan 4, 2015 1:00:00 PM\",\"bettingType\":\"ODDS\",\"turnInPlayEnabled\":true,\"marketType\":\"OVER_UNDER_35\",\"regulator\":\"GIBRALTAR REGULATOR\",\"marketBaseRate\":5.0,\"discountAllowed\":true,\"wallet\":\"UK wallet\",\"rules\":\"\",\"rulesHasDate\":true},\"runners\":[{\"selectionId\":1222344,\"runnerName\":\"Under 3.5 Goals\",\"handicap\":0.0},{\"selectionId\":1222345,\"runnerName\":\"Over 3.5 Goals\",\"handicap\":0.0}],\"competition\":{\"id\":\"30558\",\"name\":\"English FA Cup\"},\"event\":{\"id\":\"27323365\",\"name\":\"QPR v Sheff Utd\",\"countryCode\":\"GB\",\"timezone\":\"Europe/London\",\"openDate\":\"Jan 4, 2015 1:00:00 PM\",\"score\":\"NIL_NIL\",\"previousScores\":[],\"market\":{}},\"marketBook\":{\"marketId\":\"1.116825921\",\"isMarketDataDelayed\":false,\"status\":\"OPEN\",\"betDelay\":8,\"bspReconciled\":false,\"complete\":true,\"inplay\":true,\"numberOfWinners\":1,\"numberOfRunners\":2,\"numberOfActiveRunners\":2,\"lastMatchTime\":\"Jan 4, 2015 2:35:44 PM\",\"totalMatched\":62689.57,\"totalAvailable\":23001.8,\"crossMatching\":true,\"runnersVoidable\":false,\"version\":890929979,\"runners\":[{\"selectionId\":1222344,\"handicap\":0.0,\"status\":\"ACTIVE\",\"lastPriceTraded\":1.09,\"totalMatched\":50613.44,\"ex\":{\"availableToBack\":[{\"price\":1.08,\"size\":3700.07},{\"price\":1.07,\"size\":4104.44},{\"price\":1.06,\"size\":970.21}],\"availableToLay\":[{\"price\":1.09,\"size\":46.42},{\"price\":1.1,\"size\":3218.98},{\"price\":1.11,\"size\":1015.6}],\"tradedVolume\":[]}},{\"selectionId\":1222345,\"handicap\":0.0,\"status\":\"ACTIVE\",\"lastPriceTraded\":11.0,\"totalMatched\":12076.12,\"ex\":{\"availableToBack\":[{\"price\":11.5,\"size\":56.65},{\"price\":11.0,\"size\":113.36},{\"price\":10.5,\"size\":94.32}],\"availableToLay\":[{\"price\":13.0,\"size\":89.3},{\"price\":13.5,\"size\":76.85},{\"price\":14.0,\"size\":19.0}],\"tradedVolume\":[]}}]}},\"OVER_UNDER_45\":{\"marketId\":\"1.116825922\",\"marketName\":\"Over/Under 4.5 Goals\",\"description\":{\"persistenceEnabled\":true,\"bspMarket\":false,\"marketTime\":\"Jan 4, 2015 1:00:00 PM\",\"suspendTime\":\"Jan 4, 2015 1:00:00 PM\",\"bettingType\":\"ODDS\",\"turnInPlayEnabled\":true,\"marketType\":\"OVER_UNDER_45\",\"regulator\":\"GIBRALTAR REGULATOR\",\"marketBaseRate\":5.0,\"discountAllowed\":true,\"wallet\":\"UK wallet\",\"rules\":\"\",\"rulesHasDate\":true},\"runners\":[{\"selectionId\":1222347,\"runnerName\":\"Under 4.5 Goals\",\"handicap\":0.0},{\"selectionId\":1222346,\"runnerName\":\"Over 4.5 Goals\",\"handicap\":0.0}],\"competition\":{\"id\":\"30558\",\"name\":\"English FA Cup\"},\"event\":{\"id\":\"27323365\",\"name\":\"QPR v Sheff Utd\",\"countryCode\":\"GB\",\"timezone\":\"Europe/London\",\"openDate\":\"Jan 4, 2015 1:00:00 PM\",\"score\":\"NIL_NIL\",\"previousScores\":[],\"market\":{}},\"marketBook\":{\"marketId\":\"1.116825922\",\"isMarketDataDelayed\":false,\"status\":\"OPEN\",\"betDelay\":8,\"bspReconciled\":false,\"complete\":true,\"inplay\":true,\"numberOfWinners\":1,\"numberOfRunners\":2,\"numberOfActiveRunners\":2,\"lastMatchTime\":\"Jan 4, 2015 2:35:30 PM\",\"totalMatched\":74141.93,\"totalAvailable\":7791.43,\"crossMatching\":true,\"runnersVoidable\":false,\"version\":890929669,\"runners\":[{\"selectionId\":1222347,\"handicap\":0.0,\"status\":\"ACTIVE\",\"lastPriceTraded\":1.02,\"totalMatched\":71671.87,\"ex\":{\"availableToBack\":[{\"price\":1.01,\"size\":3651.17}],\"availableToLay\":[{\"price\":1.02,\"size\":1018.66},{\"price\":1.03,\"size\":900.54},{\"price\":1.04,\"size\":96.0}],\"tradedVolume\":[]}},{\"selectionId\":1222346,\"handicap\":0.0,\"status\":\"ACTIVE\",\"lastPriceTraded\":55.0,\"totalMatched\":2470.06,\"ex\":{\"availableToBack\":[{\"price\":55.0,\"size\":23.33},{\"price\":50.0,\"size\":28.06},{\"price\":48.0,\"size\":28.8}],\"availableToLay\":[{\"price\":120.0,\"size\":25.4},{\"price\":130.0,\"size\":22.44},{\"price\":160.0,\"size\":21.35}],\"tradedVolume\":[]}}]}},\"OVER_UNDER_55\":{\"marketId\":\"1.116825946\",\"marketName\":\"Over/Under 5.5 Goals\",\"description\":{\"persistenceEnabled\":true,\"bspMarket\":false,\"marketTime\":\"Jan 4, 2015 1:00:00 PM\",\"suspendTime\":\"Jan 4, 2015 1:00:00 PM\",\"bettingType\":\"ODDS\",\"turnInPlayEnabled\":true,\"marketType\":\"OVER_UNDER_55\",\"regulator\":\"GIBRALTAR REGULATOR\",\"marketBaseRate\":5.0,\"discountAllowed\":true,\"wallet\":\"UK wallet\",\"rules\":\"\",\"rulesHasDate\":true},\"runners\":[{\"selectionId\":1485567,\"runnerName\":\"Under 5.5 Goals\",\"handicap\":0.0},{\"selectionId\":1485568,\"runnerName\":\"Over 5.5 Goals\",\"handicap\":0.0}],\"competition\":{\"id\":\"30558\",\"name\":\"English FA Cup\"},\"event\":{\"id\":\"27323365\",\"name\":\"QPR v Sheff Utd\",\"countryCode\":\"GB\",\"timezone\":\"Europe/London\",\"openDate\":\"Jan 4, 2015 1:00:00 PM\",\"score\":\"NIL_NIL\",\"previousScores\":[],\"market\":{}},\"marketBook\":{\"marketId\":\"1.116825946\",\"isMarketDataDelayed\":false,\"status\":\"OPEN\",\"betDelay\":8,\"bspReconciled\":false,\"complete\":true,\"inplay\":true,\"numberOfWinners\":1,\"numberOfRunners\":2,\"numberOfActiveRunners\":2,\"lastMatchTime\":\"Jan 4, 2015 2:30:02 PM\",\"totalMatched\":21332.96,\"totalAvailable\":4491.48,\"crossMatching\":true,\"runnersVoidable\":false,\"version\":890929623,\"runners\":[{\"selectionId\":1485567,\"handicap\":0.0,\"status\":\"ACTIVE\",\"lastPriceTraded\":1.01,\"totalMatched\":20544.54,\"ex\":{\"availableToBack\":[],\"availableToLay\":[{\"price\":1.01,\"size\":898.77},{\"price\":1.02,\"size\":954.47},{\"price\":1.03,\"size\":1487.86}],\"tradedVolume\":[]}},{\"selectionId\":1485568,\"handicap\":0.0,\"status\":\"ACTIVE\",\"lastPriceTraded\":75.0,\"totalMatched\":788.41,\"ex\":{\"availableToBack\":[{\"price\":200.0,\"size\":2.0},{\"price\":190.0,\"size\":2.0},{\"price\":180.0,\"size\":2.0}],\"availableToLay\":[],\"tradedVolume\":[]}}]}}}}";
        Event event = gson.fromJson(jsonEvent, Event.class);

        System.out.println(calcPercentageProfit(event, event.getMarket().get(MarketType.MATCH_ODDS), new MatchOddsMarket(event.getMarket().get(MarketType.MATCH_ODDS))));
    }

    private Double calcPercentageProfit(Event event, MarketCatalogue marketCatalogue, MatchOddsMarket mom) throws Exception {
        Exposure exposure = new Exposure(event, marketCatalogue);
        Double layExposure = exposure.calcNetLtdExposure(true);

        Double cashOutStake = calcBackRunnerCashOutBetSize(mom, layExposure);
        Double initialStake = 2.0;

        Double profit = cashOutStake + initialStake - layExposure;

        return (profit / initialStake) * 100;
    }

    private double calcBackRunnerCashOutBetSize(MatchOddsMarket mom, Double netExposure) throws Exception {
        Runner runner = mom.getDrawRunner();
        return roundUpToNearestFraction(netExposure / mom.getPrice(runner, 0, Side.BACK).getPrice(), 0.01);
    }

    private Double roundDownToNearestFraction(Double number, Double fractionAsDecimal) {
        Double factor = 1 / fractionAsDecimal;
        return Math.round((number - (fractionAsDecimal / 2)) * factor) / factor;
    }

    private Double roundUpToNearestFraction(Double number, Double fractionAsDecimal) {
        Double factor = 1 / fractionAsDecimal;
        return Math.round((number + (fractionAsDecimal / 2)) * factor) / factor;
    }
}
